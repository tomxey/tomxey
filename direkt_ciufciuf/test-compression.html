<!DOCTYPE html>
<html>
<head>
    <title>Test Kompresji</title>
    <script src="https://unpkg.com/pako@2.1.0/dist/pako.min.js"></script>
</head>
<body>
    <h1>Test ładowania skompresowanych plików JSON</h1>
    <div id="results"></div>

    <script>
        async function testCompressedLoading() {
            const results = document.getElementById('results');

            async function loadCompressedJSON(url) {
                try {
                    console.log(`Loading ${url}...`);
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const compressedData = await response.arrayBuffer();
                    console.log(`Compressed size: ${compressedData.byteLength} bytes`);

                    const decompressed = pako.inflate(compressedData, { to: 'string' });
                    console.log(`Decompressed size: ${decompressed.length} characters`);

                    const data = JSON.parse(decompressed);
                    return data;
                } catch (error) {
                    console.error(`Error loading compressed file ${url}:`, error);
                    throw error;
                }
            }

            try {
                // Test stations
                results.innerHTML += '<p>Ładowanie stations.json.gz...</p>';
                const stations = await loadCompressedJSON('../scraper/stations.json.gz');
                results.innerHTML += `<p>✓ Stations loaded: ${Object.keys(stations).length} stations</p>`;

                // Test trains
                results.innerHTML += '<p>Ładowanie trains.json.gz...</p>';
                const trains = await loadCompressedJSON('../scraper/trains.json.gz');
                results.innerHTML += `<p>✓ Trains loaded: ${Object.keys(trains).length} trains</p>`;

                results.innerHTML += '<p><strong>✅ Test zakończony pomyślnie!</strong></p>';

            } catch (error) {
                results.innerHTML += `<p>❌ Error: ${error.message}</p>`;
                console.error('Test failed:', error);
            }
        }

        // Run test when page loads
        document.addEventListener('DOMContentLoaded', testCompressedLoading);
    </script>
</body>
</html>
